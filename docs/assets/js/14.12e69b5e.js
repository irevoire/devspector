(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{438:function(t,e,a){"use strict";a.r(e);var s=a(62),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("ul",[a("li",[t._v("Title: Filter and Facet Behavior")]),t._v(" "),a("li",[t._v("Specification PR: "),a("a",{attrs:{href:"https://github.com/meilisearch/specifications/pull/27",target:"_blank",rel:"noopener noreferrer"}},[t._v("#27"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("MeiliSearch Tracking-Issues: "),a("a",{attrs:{href:"https://github.com/meilisearch/milli/issues/152",target:"_blank",rel:"noopener noreferrer"}},[t._v("milli/#152"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://github.com/meilisearch/transplant/issues/140",target:"_blank",rel:"noopener noreferrer"}},[t._v("transplant/#140"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://github.com/meilisearch/transplant/issues/70",target:"_blank",rel:"noopener noreferrer"}},[t._v("transplant/#70"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://github.com/meilisearch/transplant/issues/81",target:"_blank",rel:"noopener noreferrer"}},[t._v("transplant/#81"),a("OutboundLink")],1)])]),t._v(" "),a("h1",{attrs:{id:"facet-and-filter-behavior"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#facet-and-filter-behavior"}},[t._v("#")]),t._v(" Facet and Filter Behavior")]),t._v(" "),a("h2",{attrs:{id:"_1-functional-specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-functional-specification"}},[t._v("#")]),t._v(" 1. Functional Specification")]),t._v(" "),a("h3",{attrs:{id:"i-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-summary"}},[t._v("#")]),t._v(" I. Summary")]),t._v(" "),a("p",[t._v("With v0.21.0, we are trying to erase the distinction between facets and filtering. "),a("code",[t._v("facetFilters")]),t._v(" is removed as a query parameter. Instead, all filters are performed with the "),a("code",[t._v("filter")]),t._v(" parameter. In addition, any attribute you wish to use with "),a("code",[t._v("filter")]),t._v(" must first be added to attributesForFaceting.")]),t._v(" "),a("h3",{attrs:{id:"ii-motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ii-motivation"}},[t._v("#")]),t._v(" II. Motivation")]),t._v(" "),a("p",[t._v("Because the users need to set the attributes to "),a("code",[t._v("attributesForFaceting")]),t._v(" no matter what they are using ("),a("code",[t._v("filters")]),t._v(" or "),a("code",[t._v("facetFilters")]),t._v(") during the search, we need to re-define the usage of the filters/facets and stay as backwards compatible as possible with the MeiliSearch v0.20.0.")]),t._v(" "),a("h3",{attrs:{id:"iii-additional-materials"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iii-additional-materials"}},[t._v("#")]),t._v(" III. Additional Materials")]),t._v(" "),a("p",[t._v("N/A")]),t._v(" "),a("h3",{attrs:{id:"iv-explanation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iv-explanation"}},[t._v("#")]),t._v(" IV. Explanation")]),t._v(" "),a("h4",{attrs:{id:"remove-facetfilters-rename-filters-to-filter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remove-facetfilters-rename-filters-to-filter"}},[t._v("#")]),t._v(" Remove "),a("code",[t._v("facetFilters")]),t._v(", Rename "),a("code",[t._v("filters")]),t._v(" to "),a("code",[t._v("filter")])]),t._v(" "),a("p",[t._v("The usage of "),a("code",[t._v("facetFilters")]),t._v(" is not needed anymore since everything is doable by only using the "),a("code",[t._v("filters")]),t._v(" parameter.\nWe rename "),a("code",[t._v("filters")]),t._v(" to "),a("code",[t._v("filter")]),t._v(" mainly because the parameter's value will only ever be a single filter string, array or mixed syntax. Even if the value can be nested allowing for complexity, it's still just a logical expression. This name implicitly describes the action of filtering the results using a single filter expression made up of several logical operators.")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Settings")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"attributesForFaceting"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"author"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Search")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"q"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filters"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price < 20"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"facetFilters"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"author:'JK Rowling'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("becomes")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Settings")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"attributesForFaceting"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"author"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Search")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"q"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"price < 20 AND author = 'JK Rowling'\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("We decided to replace the "),a("code",[t._v(":")]),t._v(" operator in favor of "),a("code",[t._v("=")]),t._v(".")]),t._v(" "),a("h4",{attrs:{id:"operator-behavior-during-search"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#operator-behavior-during-search"}},[t._v("#")]),t._v(" Operator behavior during search")]),t._v(" "),a("p",[t._v("During search, logical operators should behave as they already do in MeiliSearch v0.20.0.")]),t._v(" "),a("p",[t._v("Here is a quick reminder of the v0.20.0 operators behavior:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("<")]),t._v(", "),a("code",[t._v("=<")]),t._v(", "),a("code",[t._v(">")]),t._v(", "),a("code",[t._v("=>")]),t._v(" => only operate on number values. MeiliSearch returns only documents that have numbers in this field.\nex: "),a("code",[t._v("price > 19")]),t._v(" does not return "),a("code",[t._v('"price": "20"')]),t._v(" but returns "),a("code",[t._v('"price": 20')]),t._v(" -> no type conversions are done.")]),t._v(" "),a("li",[a("code",[t._v("=")]),t._v(", "),a("code",[t._v("!=")]),t._v("/"),a("code",[t._v("NOT")]),t._v(" => operate on string and number values. MeiliSearch returns only documents that have numbers, strings, or arrays of strings in this field.")])]),t._v(" "),a("h4",{attrs:{id:"known-limitations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#known-limitations"}},[t._v("#")]),t._v(" Known limitations")]),t._v(" "),a("ul",[a("li",[t._v("cannot filter on "),a("code",[t._v("null")]),t._v(', objects, arrays of "undefined elements" (ex: array of '),a("code",[t._v("null")]),t._v(")")])]),t._v(" "),a("h4",{attrs:{id:"accepted-syntaxes-for-filter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accepted-syntaxes-for-filter"}},[t._v("#")]),t._v(" Accepted syntaxes for "),a("code",[t._v("filter")])]),t._v(" "),a("p",[t._v("Three syntaxes will be accepted for the "),a("code",[t._v("filter")]),t._v(" parameter during search. "),a("code",[t._v("String syntax")]),t._v(", "),a("code",[t._v("Array syntax")]),t._v(" and "),a("code",[t._v("Mixed syntax")]),t._v(".")]),t._v(" "),a("h5",{attrs:{id:"string-syntax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#string-syntax"}},[t._v("#")]),t._v(" String syntax")]),t._v(" "),a("p",[t._v("The string syntax uses the "),a("code",[t._v("AND")]),t._v("/"),a("code",[t._v("OR")]),t._v("/"),a("code",[t._v("NOT")]),t._v(" operators combined with parentheses to express a search filter.")]),t._v(" "),a("p",[t._v("Example:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"(genres = Comedy OR genres = Romance) AND director = 'Mati Diop'\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h5",{attrs:{id:"array-syntax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#array-syntax"}},[t._v("#")]),t._v(" Array syntax")]),t._v(" "),a("p",[t._v("The array syntax uses dimensional array to express logical connectives.")]),t._v(" "),a("ul",[a("li",[t._v('Inner arrays elements are connected by an OR operator (e.g. [["genres:Comedy", "genres:Romance"]]).')]),t._v(" "),a("li",[t._v('Outer arrays elements are connected by an AND operator (e.g. ["genres:Romance", "director:Mati Diop"]).')])]),t._v(" "),a("p",[t._v("Example:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"genres = Comedy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"genres = Romance"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"director = 'Mati Diop'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h5",{attrs:{id:"mixed-syntax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mixed-syntax"}},[t._v("#")]),t._v(" Mixed syntax")]),t._v(" "),a("p",[t._v("The mixed syntax can mix string and array syntaxes.")]),t._v(" "),a("p",[t._v("Let's say that we want to translate")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"((genres = Comedy AND genres = Romance) OR genres = Action) AND director != 'Mati Diop'\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Example:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"genres = Comedy AND genres = Romance"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"genres = Action"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NOT director = comedy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("Note that string values that are longer than a single word need to be enclosed by quote. "),a("code",[t._v('"director = Mati Diop"')]),t._v(" will lead to a parsing error. The valid syntax is "),a("code",[t._v("\"director = 'Mati Diop'\"")]),t._v(".")])]),t._v(" "),a("h4",{attrs:{id:"filters-and-facetsdistribution-behavior"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filters-and-facetsdistribution-behavior"}},[t._v("#")]),t._v(" "),a("code",[t._v("filters")]),t._v(" and "),a("code",[t._v("facetsDistribution")]),t._v(" behavior")]),t._v(" "),a("h5",{attrs:{id:"meilisearch-v0-20-0-with-filters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#meilisearch-v0-20-0-with-filters"}},[t._v("#")]),t._v(" MeiliSearch v0.20.0 with "),a("code",[t._v("filters")])]),t._v(" "),a("p",[t._v("In MeiliSeach v0.20.0, with the following documents")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"adventure"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fantasy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("...and the following search")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"q"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filters"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price = 12"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"facetsDistribution"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("...we get the following results:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hits"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"adventure"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"facetsDistribution"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fantasy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"adventure"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("=> "),a("code",[t._v("fantasy")]),t._v(" is set to "),a("code",[t._v("1")]),t._v(" despite the fantasy book does not have a "),a("code",[t._v("price")]),t._v(" equals to "),a("code",[t._v("12")]),t._v(" as required in the "),a("code",[t._v("filters")]),t._v(".\n=> the "),a("code",[t._v("filters")]),t._v(" and the "),a("code",[t._v("facetsDistribution")]),t._v(" are not related: the "),a("code",[t._v("facetsDistribution")]),t._v(" is applied before the filters.")]),t._v(" "),a("h5",{attrs:{id:"meilisearch-v0-20-0-with-facetfilters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#meilisearch-v0-20-0-with-facetfilters"}},[t._v("#")]),t._v(" MeiliSearch v0.20.0 with "),a("code",[t._v("facetFilters")])]),t._v(" "),a("p",[t._v("In MeiliSeach v0.20.0, with the following documents")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"adventure"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"12"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fantasy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"456"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("(the test is done with "),a("code",[t._v("price")]),t._v(" as strings because MeiliSearch v0.20.0 cannot facet on numbers)")]),t._v(" "),a("p",[t._v("...and the following search")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"q"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"facetFilters"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price:12"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"facetsDistribution"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("...we get the following results:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hits"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"adventure"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"price"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"12"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"facetsDistribution"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"genre"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fantasy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"adventure"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("=> "),a("code",[t._v("fantasy")]),t._v(" is set to "),a("code",[t._v("0")]),t._v(" because the fantasy book does not have a "),a("code",[t._v("price")]),t._v(" equals to "),a("code",[t._v("12")]),t._v(" as required in the "),a("code",[t._v("facetFilters")]),t._v(".\n=> the "),a("code",[t._v("filters")]),t._v(" and the "),a("code",[t._v("facetsDistribution")]),t._v(" are related: the "),a("code",[t._v("facetsDistribution")]),t._v(" is applied after the facet filters.")]),t._v(" "),a("h5",{attrs:{id:"final-decision-for-v0-21-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#final-decision-for-v0-21-0"}},[t._v("#")]),t._v(" Final decision for v0.21.0")]),t._v(" "),a("p",[t._v("In MeiliSearch v0.21.0, "),a("code",[t._v("facetsDistribution")]),t._v(" will behave with "),a("code",[t._v("filter")]),t._v(" the same way it currently does with "),a("code",[t._v("facetFilters")]),t._v(": the "),a("code",[t._v("facetsDistribution")]),t._v(" will be applied after the filters.")]),t._v(" "),a("h4",{attrs:{id:"tldr-all-the-breaking-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tldr-all-the-breaking-changes"}},[t._v("#")]),t._v(" TLDR; all the breaking changes")]),t._v(" "),a("p",[t._v("Here is the summary of all the breaking changes (that are detailed in the paragraphs above):")]),t._v(" "),a("ul",[a("li",[t._v("The "),a("code",[t._v("facetFilters")]),t._v(" parameter during the search is removed. Only "),a("code",[t._v("filter")]),t._v(" can be used.")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("filters")]),t._v(" parameter is renamed "),a("code",[t._v("filter")]),t._v(".")]),t._v(" "),a("li",[t._v("The users need to set the attributes to "),a("code",[t._v("attributesForFaceting")]),t._v(" to use the filters during the search via the "),a("code",[t._v("filter")]),t._v(" parameters.")]),t._v(" "),a("li",[t._v("The users can now pass an attribute containing numbers (float or integer) in "),a("code",[t._v("attributesForFaceting")]),t._v(". It means they can use "),a("code",[t._v("filter")]),t._v(" and "),a("code",[t._v("facetsDistribution")]),t._v(" on this numeric field.")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("filter")]),t._v(" parameter can accept three syntaxes: string (with "),a("code",[t._v("OR")]),t._v("/"),a("code",[t._v("AND")]),t._v("/"),a("code",[t._v("NOT")]),t._v("), array and a mixed with string and array.")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v(":")]),t._v(" operator does not exist anymore (was previously present in "),a("code",[t._v("facetFilters")]),t._v(" in v0.20.0) and is replaced by "),a("code",[t._v("=")]),t._v(".")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("facetsDistribution")]),t._v(" is now applied after the "),a("code",[t._v("filter")]),t._v(" parameter. This point is currently not documented, not sure this is useful to add it to the docs.")]),t._v(" "),a("li",[t._v("All the integer in the user documents are converted into float. So integers with high values lose precision. However, integers from −2^53 to 2^53 (−9007199254740992 to 9007199254740992) can be exactly represented, which is enough in 99% of cases. Not sure this is important to documented it either.")])]),t._v(" "),a("h3",{attrs:{id:"v-impact-on-documentation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#v-impact-on-documentation"}},[t._v("#")]),t._v(" V. Impact on Documentation")]),t._v(" "),a("p",[t._v("See the previous part.")]),t._v(" "),a("p",[t._v("The documentation should present a complex filter query with multiple levels to precise that MeiliSearch is not limited to deepness level.")]),t._v(" "),a("p",[t._v("Example:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"filter"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"((genres = Comedy OR genres = Romance) AND (director = 'Mati Diop' OR director = 'Wong Kar-wai')) OR genres = 'Fantasy'\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"vi-impact-on-sdks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vi-impact-on-sdks"}},[t._v("#")]),t._v(" VI. Impact on SDKs")]),t._v(" "),a("ul",[a("li",[t._v("Remove "),a("code",[t._v("facetFilters")]),t._v(" from their payload.")]),t._v(" "),a("li",[t._v("Rename "),a("code",[t._v("filters")]),t._v(" to "),a("code",[t._v("filter")]),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"_2-technical-aspects"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-technical-aspects"}},[t._v("#")]),t._v(" 2. Technical Aspects")]),t._v(" "),a("h3",{attrs:{id:"i-abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-abstract"}},[t._v("#")]),t._v(" I. Abstract")]),t._v(" "),a("p",[t._v("Internal MeiliSearch engine uses an index data structure for each type encountered in an attribute. Doing this eliminate the need for the user to strictly type the attribute and permits to deal with loosely typed document at indexing time. Thus, facilitating the developper experience.")]),t._v(" "),a("p",[t._v("As for example, let’s imagine that we want to index two documents with a price attribute. One containing "),a("code",[t._v('"price": "20"')]),t._v(" and the second "),a("code",[t._v('"price": 20')]),t._v(" as value. The two attribute values will be stored in two different indexes.")]),t._v(" "),a("p",[t._v("Using "),a("code",[t._v("=")]),t._v(" or "),a("code",[t._v("!=")]),t._v(" operator on "),a("code",[t._v("price")]),t._v(" attribute will lead the engine to query the two indexes and get matching document ids with an "),a("code",[t._v("UNION")]),t._v(" operation. So it will return documents matching "),a("code",[t._v('"20"')]),t._v(" or "),a("code",[t._v("20")]),t._v(" as values for the "),a("code",[t._v("price")]),t._v(" attribute.")]),t._v(" "),a("h4",{attrs:{id:"implementation-details"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementation-details"}},[t._v("#")]),t._v(" Implementation Details")]),t._v(" "),a("p",[t._v("We have a database for the facets, the keys are prefixed by the field_id (u8), a level (u8) and, the facet value (f64). The facet values don't have a level when the type is a string. The data stored under those keys is the document ids that are faceted under those facets values.")]),t._v(" "),a("p",[t._v("The type of the facet (i.e. f64 or string) is stored in another data structure and this is by using it that we know how to read the facet value. If the facet type is a number we are able to use more operators like greater than or lower than (e.g. <, <=, >, >=, =, !=).")]),t._v(" "),a("h5",{attrs:{id:"indexing-phase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#indexing-phase"}},[t._v("#")]),t._v(" Indexing phase")]),t._v(" "),a("p",[t._v("When documents come in and fields are declared as facets, we start storing the facet values in the previously described database, the key becomes the facet value (as a globally ordered byte slice) and, the entry data now contains the document id that contains this facet value. Note that if the facet value is a number we store it like "),a("code",[t._v("[field id][level][left facet value][right facet value]")]),t._v(" where the level is 0 and if it is a string then we don't store the level.")]),t._v(" "),a("p",[t._v("Once the facet values that are numbers are stored we got a list of facet values prefixed with the field id and the base level (i.e. 0). We use this base level to generate more levels, each level contains groups of 4 groups of the level below, so level 1 aggregates the ids of the documents of each group of 4 facet values of level 0. The left and right facet values are the inclusive bounds of the group, the level 0 group have equal left and right bounds.")]),t._v(" "),a("h5",{attrs:{id:"querying-phase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#querying-phase"}},[t._v("#")]),t._v(" Querying phase")]),t._v(" "),a("p",[t._v("Those levels are used to reduce the number of entries to run through, reducing the time it takes to answer too wide range filter queries, like duration > 0 where 80% of the entries will match. We go through each of the levels going from the higher one, the one which describes the biggest amount of facet values and, we go deeper in the levels to find better fitting bounds.")]),t._v(" "),a("h2",{attrs:{id:"_3-future-possibilities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-future-possibilities"}},[t._v("#")]),t._v(" 3. Future Possibilities")]),t._v(" "),a("ul",[a("li",[t._v("Provide facet statistics like "),a("code",[t._v("min")]),t._v(" "),a("code",[t._v("max")]),t._v(" "),a("code",[t._v("sum")]),t._v(" "),a("code",[t._v("average")])]),t._v(" "),a("li",[t._v("Rename "),a("code",[t._v("attributesForFaceting")]),t._v(" for clarity.")]),t._v(" "),a("li",[t._v("Rename "),a("code",[t._v("facetsDistribution")]),t._v(" for clarity.")])])])}),[],!1,null,null,null);e.default=r.exports}}]);