(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{455:function(e,t,a){"use strict";a.r(t);var s=a(62),i=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("ul",[a("li",[e._v("Title: Auto-Batching")])]),e._v(" "),a("h1",{attrs:{id:"auto-batching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#auto-batching"}},[e._v("#")]),e._v(" Auto-Batching")]),e._v(" "),a("h2",{attrs:{id:"_1-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-summary"}},[e._v("#")]),e._v(" 1. Summary")]),e._v(" "),a("p",[e._v("Meilisearch can automatically group consecutive asynchronous "),a("code",[e._v("documentAddition")]),e._v(" or "),a("code",[e._v("documentPartial")]),e._v(" tasks for the same index via an automatic batching mechanism.")]),e._v(" "),a("p",[e._v("The user can enable this auto-batching behavior through various command flag options.")]),e._v(" "),a("h2",{attrs:{id:"_2-motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-motivation"}},[e._v("#")]),e._v(" 2. Motivation")]),e._v(" "),a("p",[e._v("We have regularly collected user pain points pointing out the slow indexing over the last year. We explained several times to users to make batches containing a maximum of documents to be updated/added to compress the indexing time of specific data structures.")]),e._v(" "),a("p",[e._v("To make Meilisearch easier to use, we explored the idea of automatically creating these batches within Meilisearch before indexing usersâ€™ documents.")]),e._v(" "),a("h2",{attrs:{id:"_3-functional-specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-functional-specification"}},[e._v("#")]),e._v(" 3. Functional  Specification")]),e._v(" "),a("h3",{attrs:{id:"_3-1-explanations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-explanations"}},[e._v("#")]),e._v(" 3.1. Explanations")]),e._v(" "),a("p",[e._v("All "),a("code",[e._v("tasks")]),e._v(" are part of a batch identified by a "),a("code",[e._v("batchUid")]),e._v(". A task batch preserves the logical order of the tasks for a given index.")]),e._v(" "),a("p",[e._v("Only consecutive "),a("code",[e._v("documentAddition")]),e._v(" and "),a("code",[e._v("documentPartial")]),e._v(" tasks for the same index can have the same "),a("code",[e._v("batchUid")]),e._v(". All "),a("code",[e._v("tasks")]),e._v(" concerning other operations will also be part of a "),a("code",[e._v("batchUid")]),e._v(" having only one task.")]),e._v(" "),a("h4",{attrs:{id:"_3-1-1-grouping-tasks-to-a-single-batch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-grouping-tasks-to-a-single-batch"}},[e._v("#")]),e._v(" 3.1.1. Grouping tasks to a single batch")]),e._v(" "),a("p",[e._v("The scheduling program that groups tasks within a single batch is triggered when an asynchronous "),a("code",[e._v("task")]),e._v(" currently processed reaches a terminal state as "),a("code",[e._v("succeeded")]),e._v(" or "),a("code",[e._v("failed")]),e._v(".")]),e._v(" "),a("p",[e._v("In other words, when a scheduled "),a("code",[e._v("documentAddition")]),e._v(" task for a given index is picked from the task queue, the scheduler fetches and groups all "),a("code",[e._v("documentAddition")]),e._v(" tasks for that same index in a batch.")]),e._v(" "),a("p",[e._v("The more similar consecutive tasks the user sends in a row, the more likely the batching mechanism can group these tasks.")]),e._v(" "),a("h5",{attrs:{id:"_3-1-1-1-schema"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-1-schema"}},[e._v("#")]),e._v(" 3.1.1.1. Schema")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/3692335/145787054-4cb07b5e-c80e-498a-8843-d0cc46329e9b.png",alt:"Auto-batching Process"}})]),e._v(" "),a("h5",{attrs:{id:"_3-1-1-2-batchuid-generation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-2-batchuid-generation"}},[e._v("#")]),e._v(" 3.1.1.2. "),a("code",[e._v("batchUid")]),e._v(" generation")]),e._v(" "),a("p",[e._v("The batch identifiers are unique and strictly increasing.")]),e._v(" "),a("h4",{attrs:{id:"_3-1-2-impacts-on-task-api-resource"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-impacts-on-task-api-resource"}},[e._v("#")]),e._v(" 3.1.2. Impacts on "),a("code",[e._v("task")]),e._v(" API resource")]),e._v(" "),a("ul",[a("li",[e._v("The different tasks grouped in a batch are processed within the same transaction. If a task fails within a batch, the whole batch fails.")]),e._v(" "),a("li",[e._v("A "),a("code",[e._v("batchUid")]),e._v(" field is only added on fully-qualified "),a("code",[e._v("task")]),e._v(" API objects. "),a("code",[e._v("batchUid")]),e._v(" values are unique and strictly increasing.")]),e._v(" "),a("li",[e._v("Tasks within the same batch share the same values for the "),a("code",[e._v("startedAt")]),e._v(", "),a("code",[e._v("finishedAt")]),e._v(", "),a("code",[e._v("duration")]),e._v(" fields, and the same "),a("code",[e._v("error")]),e._v(" object if an error occurs for a "),a("code",[e._v("task")]),e._v(" during the batch processing.")]),e._v(" "),a("li",[e._v("If a batch contains many "),a("code",[e._v("tasks")]),e._v(", the "),a("code",[e._v("task")]),e._v(" "),a("code",[e._v("details")]),e._v(" "),a("code",[e._v("indexedDocuments")]),e._v(" is identical in all "),a("code",[e._v("tasks")]),e._v(" belonging to the same processed "),a("code",[e._v("batch")]),e._v(".")])]),e._v(" "),a("h3",{attrs:{id:"_3-2-auto-batching-mechanisms-options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-auto-batching-mechanisms-options"}},[e._v("#")]),e._v(" 3.2. Auto-batching mechanisms options")]),e._v(" "),a("h3",{attrs:{id:"_3-2-1-enable-auto-batching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-enable-auto-batching"}},[e._v("#")]),e._v(" 3.2.1. "),a("code",[e._v("--enable-auto-batching")])]),e._v(" "),a("p",[e._v("By default, the auto-batching feature is disabled.")]),e._v(" "),a("p",[e._v("The auto-batching feature can be activated by passing the command flag "),a("code",[e._v("--enable-auto-batching")]),e._v(" to Meilisearch at launch.")]),e._v(" "),a("h3",{attrs:{id:"_3-2-2-max-batch-size"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-max-batch-size"}},[e._v("#")]),e._v(" 3.2.2.  "),a("code",[e._v("--max-batch-size")])]),e._v(" "),a("p",[a("code",[e._v("--max-batch-size <NUM>")]),e._v(" allows setting the maximum number "),a("code",[e._v("NUM")]),e._v(" of tasks that can be processed together within a single batch.")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("0")]),e._v(" is set it will be replaced by "),a("code",[e._v("1")]),e._v(", since such a value would prevent any task from ever being processed.")]),e._v(" "),a("p",[e._v("If not specified, this is unlimited.")]),e._v(" "),a("h3",{attrs:{id:"_3-2-3-max-documents-per-batch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-max-documents-per-batch"}},[e._v("#")]),e._v(" 3.2.3. "),a("code",[e._v("--max-documents-per-batch")])]),e._v(" "),a("p",[a("code",[e._v("--max-documents-per-batch <NUM>")]),e._v(" allows setting a limit to the maximum number "),a("code",[e._v("NUM")]),e._v(" of documents that can be indexed together within a single batch.")]),e._v(" "),a("p",[e._v("Since the batch can't split one update in half, this value is rounded up to the number of documents in the last document addition.")]),e._v(" "),a("p",[e._v("If not specified, this is unlimited.")]),e._v(" "),a("h3",{attrs:{id:"_3-2-4-debounce-duration-sec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-debounce-duration-sec"}},[e._v("#")]),e._v(" 3.2.4. "),a("code",[e._v("--debounce-duration-sec")])]),e._v(" "),a("p",[a("code",[e._v("--debounce-duration-sec <SECS>")]),e._v(" wait at least "),a("code",[e._v("SECS")]),e._v(" seconds between the time the scheduler is notified of a new "),a("code",[e._v("task")]),e._v(" and the processing of the next batch.")]),e._v(" "),a("p",[e._v("Snapshots and dumps are impacted by this debounce duration. It means that they will be processed at the end of the current debounce duration.")]),e._v(" "),a("p",[e._v("Defaults to "),a("code",[e._v("0")]),e._v("secs (process immediately).")]),e._v(" "),a("h2",{attrs:{id:"_4-technical-aspects"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-technical-aspects"}},[e._v("#")]),e._v(" 4. Technical Aspects")]),e._v(" "),a("p",[e._v("N/A")]),e._v(" "),a("h2",{attrs:{id:"_5-future-possibilities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-future-possibilities"}},[e._v("#")]),e._v(" 5. Future Possibilities")]),e._v(" "),a("ul",[a("li",[e._v("Extends it for all consecutive payload types.")]),e._v(" "),a("li",[e._v("Add a filter capability by "),a("code",[e._v("batchUid")]),e._v(" on the "),a("code",[e._v("/tasks")]),e._v(" endpoints.")]),e._v(" "),a("li",[e._v("Do not fail the entire transaction if a document is not valid. Report the documents that could not be indexed to the user.")]),e._v(" "),a("li",[e._v("Enable auto-batching by default.")]),e._v(" "),a("li",[e._v("Optimize some tasks sequence, for example if there is a document addition followed by an index deletion, we could skip the document addition")])])])}),[],!1,null,null,null);t.default=i.exports}}]);