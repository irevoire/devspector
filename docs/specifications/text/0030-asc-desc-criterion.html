<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Welcome to the Meilisearch dev specifications!</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.b26ff90a.css" as="style"><link rel="preload" href="/assets/js/app.b890e41e.js" as="script"><link rel="preload" href="/assets/js/3.7860be15.js" as="script"><link rel="preload" href="/assets/js/16.5bbcf611.js" as="script"><link rel="prefetch" href="/assets/js/10.867f19e5.js"><link rel="prefetch" href="/assets/js/11.5950006a.js"><link rel="prefetch" href="/assets/js/12.3fc27b6c.js"><link rel="prefetch" href="/assets/js/13.569b541d.js"><link rel="prefetch" href="/assets/js/14.5eb4b1a7.js"><link rel="prefetch" href="/assets/js/15.ffba3d85.js"><link rel="prefetch" href="/assets/js/17.052e3dd6.js"><link rel="prefetch" href="/assets/js/18.1930f072.js"><link rel="prefetch" href="/assets/js/19.4af2be90.js"><link rel="prefetch" href="/assets/js/20.bbf42276.js"><link rel="prefetch" href="/assets/js/21.2d9b101a.js"><link rel="prefetch" href="/assets/js/22.1f07eccb.js"><link rel="prefetch" href="/assets/js/23.49f62338.js"><link rel="prefetch" href="/assets/js/24.bdd429da.js"><link rel="prefetch" href="/assets/js/25.d65be380.js"><link rel="prefetch" href="/assets/js/26.b95e819f.js"><link rel="prefetch" href="/assets/js/27.f12a6568.js"><link rel="prefetch" href="/assets/js/28.f5f1be8c.js"><link rel="prefetch" href="/assets/js/29.28370923.js"><link rel="prefetch" href="/assets/js/30.d05af041.js"><link rel="prefetch" href="/assets/js/31.253b9bfc.js"><link rel="prefetch" href="/assets/js/32.733e95db.js"><link rel="prefetch" href="/assets/js/33.3c665714.js"><link rel="prefetch" href="/assets/js/34.a4e294f1.js"><link rel="prefetch" href="/assets/js/35.2fbca171.js"><link rel="prefetch" href="/assets/js/36.e60a6e3a.js"><link rel="prefetch" href="/assets/js/37.2e37d485.js"><link rel="prefetch" href="/assets/js/38.47a33431.js"><link rel="prefetch" href="/assets/js/39.017a6062.js"><link rel="prefetch" href="/assets/js/4.00ff60b8.js"><link rel="prefetch" href="/assets/js/40.a7044b1c.js"><link rel="prefetch" href="/assets/js/41.f19ee942.js"><link rel="prefetch" href="/assets/js/42.534278aa.js"><link rel="prefetch" href="/assets/js/43.38811573.js"><link rel="prefetch" href="/assets/js/44.1be5b8c4.js"><link rel="prefetch" href="/assets/js/45.83835c91.js"><link rel="prefetch" href="/assets/js/46.0a56b5d8.js"><link rel="prefetch" href="/assets/js/47.7b51c9d1.js"><link rel="prefetch" href="/assets/js/48.0a681b8c.js"><link rel="prefetch" href="/assets/js/49.c3c4d010.js"><link rel="prefetch" href="/assets/js/5.06848b4d.js"><link rel="prefetch" href="/assets/js/6.87f02c74.js"><link rel="prefetch" href="/assets/js/7.fadbe260.js"><link rel="prefetch" href="/assets/js/8.d45b99a8.js"><link rel="prefetch" href="/assets/js/9.0c014273.js"><link rel="prefetch" href="/assets/js/vendors~docs-searchbar.9a2822a3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b26ff90a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Welcome to the Meilisearch dev specifications!</span></a> <div class="links"><form id="search-form" role="search" class="meilisearch-search-wrapper search-box"><input id="meilisearch-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/specifications/text/specifications/text/0000-specification-template.html" class="nav-link">
  Specification
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/specifications/text/specifications/text/0000-specification-template.html" class="nav-link">
  Specification
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/specifications/text/0000-specification-template.html" class="sidebar-link">Specification template</a></li><li><a href="/specifications/text/0001-frontend-disable-prod.html" class="sidebar-link">Frontend disable prod</a></li><li><a href="/specifications/text/0001-script-based-tokenizer.html" class="sidebar-link">Script based tokenizer</a></li><li><a href="/specifications/text/0028-indexing-csv.html" class="sidebar-link">Indexing csv</a></li><li><a href="/specifications/text/0029-indexing-ndjson.html" class="sidebar-link">Indexing ndjson</a></li><li><a href="/specifications/text/0030-asc-desc-criterion.html" aria-current="page" class="active sidebar-link">Asc desc criterion</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/specifications/text/0030-asc-desc-criterion.html#_1-feature-description-and-interaction" class="sidebar-link">1. Feature Description and Interaction</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0030-asc-desc-criterion.html#_2-technical-aspects" class="sidebar-link">2. Technical Aspects</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0030-asc-desc-criterion.html#_3-future-possibilities" class="sidebar-link">3. Future possibilities</a></li></ul></li><li><a href="/specifications/text/0032-distinct-attribute.html" class="sidebar-link">Distinct attribute</a></li><li><a href="/specifications/text/0033-logging.html" class="sidebar-link">Logging</a></li><li><a href="/specifications/text/0034-telemetry-policies.html" class="sidebar-link">Telemetry policies</a></li><li><a href="/specifications/text/0036-exactness-criterion.html" class="sidebar-link">Exactness criterion</a></li><li><a href="/specifications/text/0038-rename-attributes-for-faceting.html" class="sidebar-link">Rename attributes for faceting</a></li><li><a href="/specifications/text/0043-phrase-query.html" class="sidebar-link">Phrase query</a></li><li><a href="/specifications/text/0047-reset-stop-words-synonyms-settings-with-null.html" class="sidebar-link">Reset stop words synonyms settings with null</a></li><li><a href="/specifications/text/0048-rename-max-mdb-size-var.html" class="sidebar-link">Rename max mdb size var</a></li><li><a href="/specifications/text/0055-sort.html" class="sidebar-link">Sort</a></li><li><a href="/specifications/text/0059-geo-search.html" class="sidebar-link">Geo search</a></li><li><a href="/specifications/text/0060-tasks-api.html" class="sidebar-link">Tasks api</a></li><li><a href="/specifications/text/0061-error-format-and-definitions.html" class="sidebar-link">Error format and definitions</a></li><li><a href="/specifications/text/0077-words-position-limit.html" class="sidebar-link">Words position limit</a></li><li><a href="/specifications/text/0085-api-keys.html" class="sidebar-link">Api keys</a></li><li><a href="/specifications/text/0089-tenant-tokens.html" class="sidebar-link">Tenant tokens</a></li><li><a href="/specifications/text/0096-auto-batching.html" class="sidebar-link">Auto batching</a></li><li><a href="/specifications/text/0105-dumps-api.html" class="sidebar-link">Dumps api</a></li><li><a href="/specifications/text/0117-typo-tolerance-setting-api.html" class="sidebar-link">Typo tolerance setting api</a></li><li><a href="/specifications/text/0118-search-api.html" class="sidebar-link">Search api</a></li><li><a href="/specifications/text/0119-instance-options.html" class="sidebar-link">Instance options</a></li><li><a href="/specifications/text/0121-data-types.html" class="sidebar-link">Data types</a></li><li><a href="/specifications/text/0123-displayed-attributes-setting-api.html" class="sidebar-link">Displayed attributes setting api</a></li><li><a href="/specifications/text/0123-distinct-attribute-setting-api.html" class="sidebar-link">Distinct attribute setting api</a></li><li><a href="/specifications/text/0123-filterable-attributes-setting-api.html" class="sidebar-link">Filterable attributes setting api</a></li><li><a href="/specifications/text/0123-ranking-rules-setting-api.html" class="sidebar-link">Ranking rules setting api</a></li><li><a href="/specifications/text/0123-searchable-attributes-setting-api.html" class="sidebar-link">Searchable attributes setting api</a></li><li><a href="/specifications/text/0123-settings-api.html" class="sidebar-link">Settings api</a></li><li><a href="/specifications/text/0123-sortable-attributes-setting-api.html" class="sidebar-link">Sortable attributes setting api</a></li><li><a href="/specifications/text/0123-stop-words-setting-api.html" class="sidebar-link">Stop words setting api</a></li><li><a href="/specifications/text/0123-synonyms-setting-api.html" class="sidebar-link">Synonyms setting api</a></li><li><a href="/specifications/text/0124-documents-api.html" class="sidebar-link">Documents api</a></li><li><a href="/specifications/text/0132-indexes-api.html" class="sidebar-link">Indexes api</a></li><li><a href="/specifications/text/0134-stats-api.html" class="sidebar-link">Stats api</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li>Title: ASC / DESC Criterion</li> <li>Start Date: 2021-04-14</li> <li>Specification PR: <a href="https://github.com/meilisearch/specifications/pull/30" target="_blank" rel="noopener noreferrer">#30<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>MeiliSearch Tracking-Issues: <a href="https://github.com/meilisearch/milli/issues/161" target="_blank" rel="noopener noreferrer">#161<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h1 id="asc-desc-criterion"><a href="#asc-desc-criterion" class="header-anchor">#</a> Asc/Desc Criterion</h1> <h2 id="_1-feature-description-and-interaction"><a href="#_1-feature-description-and-interaction" class="header-anchor">#</a> 1. Feature Description and Interaction</h2> <h3 id="i-summary"><a href="#i-summary" class="header-anchor">#</a> I. Summary</h3> <p>Ranking rules are built-in rules that ensure relevancy in search results. Ranking rules are applied in a default order which can be changed in the settings. You can add or remove rules and change their order of importance.</p> <p>MeiliSearch allows you to create custom rules within the default rules. Custom rules are dedicated to sorting in ascending or descending order on an attribute.</p> <h3 id="ii-motivation"><a href="#ii-motivation" class="header-anchor">#</a> II. Motivation</h3> <p>We want to provide our users with an always improved usage experience. Relevance is essential in a search engine since it is what allows the engine to fulfill its objective. Delivering results that match user demands by allowing modification of the relevance is critical.</p> <p>The new search engine called Milli no longer processes this criterion of relevance the same way as the current MeilliSearch. This specification aims to make Milli identical both in API usage and in expected search results as the current ISO version (v0.20).</p> <h3 id="iii-additional-materials"><a href="#iii-additional-materials" class="header-anchor">#</a> III. Additional Materials</h3> <h4 id="algolia"><a href="#algolia" class="header-anchor">#</a> Algolia</h4> <p>Algolia offers 8 classification rules to achieve relevance.</p> <ul><li>Number of typos</li> <li>Geolocation</li> <li>Number of words in the query matching in the result</li> <li>Filters</li> <li>Distance between words</li> <li>Best matching attribute in the record</li> <li>Number of words matching exactly (without typo)</li> <li>Custom ranking</li></ul> <p>Note that Algolia doesn't recommend changing the order of the default criteria because of the fact that it works for the vast majority of their use cases. Like MeiliSearch (v0.20), documents, where the attribute specified in the custom ranking is missing, are pushed to the bottom of the search results.</p> <h3 id="iv-explanation"><a href="#iv-explanation" class="header-anchor">#</a> IV.Explanation</h3> <h4 id="current-behavior-of-v0-20"><a href="#current-behavior-of-v0-20" class="header-anchor">#</a> Current behavior of v0.20</h4> <p>In the case of one or many custom ASC / DESC rules configured at different places within the rankings rules, the sorting results can appear undefined when the documents do not necessarily contain the attributes which are set on this rule.</p> <p>E.g.
Given this set of documents</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">4.99</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">19.99</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>Given this custom ordering of ranking rules</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token string">&quot;exactness&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;words&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;proximity&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;attribute&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;asc(price)&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;wordsPosition&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;typo&quot;</span>
<span class="token punctuation">]</span>
</code></pre></div><p>A search with <code>q</code> containing <code>t-shirt</code> will return:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">4.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">19.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A search with <code>q</code> containing <code>t-short</code> will return:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">19.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">4.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is because the exactness criterion is set before the asc/desc criterion.</p> <p>A search with <code>q</code> containing <code>t-shart</code> will return:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">4.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">19.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;colors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t-short&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The results are firstly bucketed by the <code>asc(price)</code> criterion before the last <code>typo</code> criterion.</p> <p>This criterion can only be used with an attribute containing numbers.</p> <h4 id="current-behavior-of-milli"><a href="#current-behavior-of-milli" class="header-anchor">#</a> Current behavior of Milli</h4> <p>If the attribute on which the ASC / DESC criterion is configured does not exist in all the documents of the index concerned by the search, Milli will discard them and never return them. This behavior is not necessarily what a end user would expect when searching.</p> <p>As v0.20, Milli can’t handle ASC / DESC criterion on string. Only numbers allow its use.</p> <h4 id="decisions"><a href="#decisions" class="header-anchor">#</a> Decisions</h4> <ol><li>We thought about allowing filtering of the attributes used in the ASC / DESC criterion as long as it would also be declared in the <code>attributesForFaceting</code> parameter.</li></ol> <p>✅ We have decided that Milli will act exactly as MeiliSearch: no need to declare the ranking rule field in <code>attributeForFaceting</code> since the rankings rules and the attributes for faceting do not strictly meet the same needs. Moreover, this could confuse the users configuring the search engine. The criterion configuration will remain on the <code>rankingRrules</code> field of the <a href="https://docs.meilisearch.com/reference/api/settings.html#get-settings" target="_blank" rel="noopener noreferrer">global settings endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and in the
<a href="https://docs.meilisearch.com/reference/api/ranking_rules.html" target="_blank" rel="noopener noreferrer">specific ranking rules setting endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <ol start="2"><li>We wondered if Milli's current behavior, which is to discard documents from search results that do not have the attribute configured as ascending and descending criteria might make sense for the purpose of a user performing a search.</li></ol> <p>✅ We have decided that Milli will act exactly as MeiliSearch concerning search results. The ASC / DESC criterion will no longer discard documents which do not have the attribute.</p> <h3 id="v-impact-on-documentation"><a href="#v-impact-on-documentation" class="header-anchor">#</a> V. Impact on documentation</h3> <ul><li>It should inform users that having custom ASC / DESC criteria on attributes that are not always defined for each document may return results that are not necessarily relevant in the end user's eye.</li></ul> <blockquote><p>Already done by https://github.com/meilisearch/documentation/pull/905</p></blockquote> <ul><li>To be able to use this criterion on a date format, it must indicate that the timestamp is to be preferred since the string type is not supported.</li></ul> <blockquote><p>Related to https://github.com/meilisearch/documentation/issues/840.</p></blockquote> <h3 id="vi-impact-on-sdks"><a href="#vi-impact-on-sdks" class="header-anchor">#</a> VI. Impact on SDKs</h3> <p>N/A</p> <h2 id="_2-technical-aspects"><a href="#_2-technical-aspects" class="header-anchor">#</a> 2. Technical Aspects</h2> <p>To apply the ranking rule, the search engine needs to create a database. This database is the same as we create to apply facets and filters on an attribute.
However, the users will not pass the attribute into <code>attributeForFaceting</code> when setting a ranking rule. It means the search engine must create this database for the related attribute.</p> <p>ex:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;rankingRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;words&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;typo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;asc(price)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;proximity&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;attributesForFaceting&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;genre&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>means the search engine has to create facet databases for <code>genre</code> and <code>price</code>.</p> <p>⚠️ Following this example, it also means the search engine would be technically able to apply filters and facet distribution on <code>price</code>, however, we should prevent this. To avoid confusion, the search engine should prevent the users to execute a filter or get facet distribution on the ranking attributes. Only the ranking rule should be available for this field.</p> <p>If the user wants to filter on that attribute, he will have to add it in <code>attributesForFaceting</code> as well.</p> <h2 id="_3-future-possibilities"><a href="#_3-future-possibilities" class="header-anchor">#</a> 3. Future possibilities</h2> <ul><li>ASC / DESC criterion on string value.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/specifications/text/0029-indexing-ndjson.html" class="prev">
        Indexing ndjson
      </a></span> <span class="next"><a href="/specifications/text/0032-distinct-attribute.html">
        Distinct attribute
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b890e41e.js" defer></script><script src="/assets/js/3.7860be15.js" defer></script><script src="/assets/js/16.5bbcf611.js" defer></script>
  </body>
</html>
